function makeComment(t,e,n){return $('<div class="row"><div class="col-md-2 comment-username"><strong>'+t+'</strong></div><div class="col-md-10 comment-comment"> '+e+'<span class="glyphicon glyphicon-remove delete-comment-button" data-id="'+n+'"aria-hidden="true"></span></div></div>')}function loadComments(){var t=$("#factcontainer").data("factid");$.get("/comments/fact/"+t,function(t){"success"==t.status&&($(".comments-comments").html(""),t.data.forEach(function(t){console.log(t),$(".comments-comments").append(makeComment(t.username,t.comment,t.id))}))})}function voteCallback(t){return"error"==t.status?void showMessage(t.message):void("success"==t.status&&(1==Number(t.vote)?$("#upvotecount").text(Number($("#upvotecount").text())+1):$("#downvotecount").text(Number($("#downvotecount").text())+1)))}function vote(t,e,n){$.ajax({type:"POST",url:"/votes",data:{type:t,fact:e},success:n,dataType:"json"})}function showMessage(t){var e=$("#app-message"),n=e.children(".message-content");n.text(t),e.fadeIn(),setTimeout(function(){e.fadeOut()},5e3)}function loadFact(t){$.get("/facts/"+t,function(t){"error"!=t.status&&($("#comments").hide(),$(".comments-comments").html(""),$("#factcontainer").data("factid",t.fact_id),document.getElementById("factcontent").innerHTML=t.fact,document.getElementById("upvotecount").innerHTML=t.upvotes,document.getElementById("downvotecount").innerHTML=t.downvotes,document.getElementById("factusername").innerHTML=t.username)})}function saadaAjax(){$.get("/facts/next",function(t){window.location.hash=t.fact_id,$("#comments").hide(),$(".comments-comments").html(""),$("#factcontainer").data("factid",t.fact_id),document.getElementById("factcontent").innerHTML=t.fact,document.getElementById("upvotecount").innerHTML=t.upvotes,document.getElementById("downvotecount").innerHTML=t.downvotes,document.getElementById("factusername").innerHTML=t.username})}function moreComments(){var t=9,e=3;$("#loadMoreButton").hide(),$("#comment-1").load("/comment/next",function(n,o,a){if("success"==o){var c=JSON.parse(n);console.log(c),document.getElementById("comment-1").innerHTML="Kasutaja1 kommentaar",$("#commentSection").append("<div class='row'><div class='col-md-2'><strong>"+c.user+"</strong></div><div class='col-md-10'>"+c.comment+"</div></div>")}"error"==o&&alert("Error: "+a.status+": "+a.statusText),i<t-e&&(i++,$("#loadMoreButton").show())})}function initMap(){map=new google.maps.Map(document.getElementById("map"),{zoom:7,center:{lat:58.594344,lng:25.5423},mapTypeId:"terrain"});new google.maps.LatLng(58.594344,25.5452);loadMap(function(t){t.visitors.forEach(function(t){var e=new google.maps.LatLng(t.lat,t.lng);new google.maps.Marker({position:e,map:map,icon:getCircle(t.count),label:String(t.count)})})})}function getCircle(t){return{path:google.maps.SymbolPath.CIRCLE,fillColor:"#22A7F0",fillOpacity:.1,scale:5*t,strokeColor:"black",strokeWeight:.5}}function loadMap(t){var e={};$.ajax({url:"factify.xml",method:"GET",dataType:"XML",success:function(n){e.visitors=[],$(n).find("visitor").each(function(n,o){e.visitors.push({lat:$(o).children("lat").text(),lng:$(o).children("lng").text(),count:$(o).children("count").text()}),t(e)})}})}$(function(){$(".showcomments").click(function(){$("#comments").toggle(),loadComments()}),$("#login-form-link").click(function(t){$("#login-form").delay(100).fadeIn(100),$("#register-form").fadeOut(100),$("#register-form-link").removeClass("active"),$(this).addClass("active"),t.preventDefault()}),$("#register-form-link").click(function(t){$("#register-form").delay(100).fadeIn(100),$("#login-form").fadeOut(100),$("#login-form-link").removeClass("active"),$(this).addClass("active"),t.preventDefault()}),$(document).ready(function(){$('[data-toggle="tooltip"]').tooltip()}),$("#bestof-interval").change(function(t){window.location.search="time="+$(this).val()}),$("#upvote").click(function(){console.log("test");var t=$("#factcontainer").data("factid");vote(1,t,voteCallback)}),$("#downvote").click(function(){var t=$("#factcontainer").data("factid");vote(-1,t,voteCallback)}),$("#addcommentbutton").click(function(t){t.preventDefault();var e=$("#commenttext").val(),n=$("#factcontainer").data("factid");return e.length<3?void showMessage("Liiga lÃ¼hike kommentaar!"):void $.ajax({type:"POST",url:"/comments",data:{comment:e,fact:n},success:function(t){"success"==t.status&&(loadComments(),$("#commenttext").val(""))},dataType:"json"})}),$(".delete-fact-button").click(function(){var t=$(this).data("id"),e=this;$.ajax({method:"DELETE",url:"/facts/"+t,success:function(t){"success"==t.status&&$(e).parent().parent().fadeOut("slow").remove()},dataType:"json",contentType:"application/json"})}),$("body").on("click",".delete-comment-button",function(){var t=$(this).data("id"),e=this;$.ajax({method:"DELETE",url:"/comments/"+t,success:function(t){"success"==t.status&&$(e).parent().parent().fadeOut("slow").remove()},dataType:"json",contentType:"application/json"})})});var webSockets={webSocketServerUri:"wss://"+window.location.host,connectionStatus:"NOT_CONNECTED",init:function(){websocket=new WebSocket(this.webSocketServerUri),self=this,websocket.onopen=function(t){self.onOpen(t)},websocket.onclose=function(t){self.onClose(t)},websocket.onmessage=function(t){self.onMessage(t)},websocket.onerror=function(t){self.onError(t)}},onOpen:function(t){this.connectionStatus="CONNECTED"},onClose:function(t){this.connectionStatus="CLOSED"},onMessage:function(t){showMessage(t.data)},onError:function(t){console.log(t)}};$(function(){webSockets.init()}),window.onload=function(){if(i=0,0==$("#nextfact").length)return!1;if($("#nextfact").click(saadaAjax),""!=window.location.hash&&"#"!=window.location.hash){var t=window.location.hash;return void loadFact(t.replace("#",""))}saadaAjax()};var map;